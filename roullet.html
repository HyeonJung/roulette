<!DOCTYPE HTML>
<html lang="ko">
<head>
<title> 룰렛 </title>
<meta charset="utf-8">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript" src="js/jqueryRotate.js"></script>
<style>
#image{
  margin:50px 50px;z-index:10;
}
#n_id{position:absolute;left:490px;top:297px;z-index:20;}
#start_btn{position:absolute;left:240px;top:240px;}
</style>
</head>
<body>

<canvas id="circle" width="600" height="600"></canvas>
<!--<img src="img/roulette.png" id="image">-->

<img src="img/niddle.png" id="n_id">
<img src="img/start.png" id="start_btn">
<br />

<input type="text" id="c1"/><br/>
<input type="text" id="c2"/><br/>
<input type="text" id="c3"/><br/>
<input type="text" id="c4"/><br/>

<input type="button" value="만들기" id="make"/>


<div id="result_id"></div>
<div id="result_id2"></div>
<div id="result_id3"></div>

<script>
window.onload = function(){

    draw();
    
    var pArr = ["c1","c2","c3","c4","c5"];
    var rate;
    var fillColor = ["#FFFFFF","#c82124","#3370d4","#FF9933","#339900","#CC6699"]

    
    $('#start_btn').click(function(){
        rotation();
    });
    
    $('#make').click(function() {
        make();
    })

    /**
     * 회전
     */
    function rotation(){
        $("#circle").rotate({
          angle:0,
          animateTo:360 * 10 + randomize(0, 360),
          center: ["50%", "50%"],
          easing: $.easing.easeInOutElastic,
          callback: function(){
                        var n = $(this).getRotateAngle();
                        endAnimate(n);
                    },
          duration:5000
       });
    }
    
    /**
     * 당첨
     */
    function endAnimate($n){
        var n = $n;
        
        var real_angle = n%360;
        // $('#result_id').html("<p>움직인각도:" + n + "," + real_angle + "</p>");
        var result;

        for (var i = rate.length; i >= 0; i--) {

            if (real_angle < 360 - rate[i]) {
                result = pArr[i];
                break;
            }
        }
        
        alert("당첨 : " + result);
    }
 
    function randomize($min, $max){
        return Math.floor(Math.random() * ($max - $min + 1)) + $min;
    }

    /**
     * 원 그리기
     */
    function draw() {
        var canvas = document.getElementById('circle');
            if (canvas.getContext)
            {
                var ctx = canvas.getContext('2d'); 
                
                var X = canvas.width / 2;
                var Y = canvas.height / 2;
                var R = 250;
                ctx.beginPath();
                ctx.arc(X, Y, R, 0, 2 * Math.PI, false);
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#000000';

                ctx.stroke();
            }
    }

    /**
     * 룰렛 그리기
     */
    function make() {
       
        
        var textRadius = 160;
        var c1 = parseInt(document.getElementById('c1').value);
        var c2 = parseInt(document.getElementById('c2').value) + c1;
        var c3 = parseInt(document.getElementById('c3').value) + c2;
        var c4 = parseInt(document.getElementById('c4').value) + c3;

        rate = [0,c1,c2,c3,c4,360];
        
         var canvas = document.getElementById('circle');
         if (canvas.getContext)
        {
            var ctx = canvas.getContext('2d');
            ctx.clearRect(0,0,600,600);
                       
            for (var i = 1; i < rate.length; i++) {
                var angle = (Math.PI/180) * rate[i-1];
                var arc = (Math.PI/180) * rate[i] - angle;
                ctx.beginPath();
                ctx.moveTo(300, 300);
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#000000';
                ctx.arc(300,300,250,(Math.PI/180)*rate[i-1], (Math.PI/180)*rate[i],false);
                ctx.fillStyle = fillColor[i];
                ctx.stroke();
                ctx.fill();
                
                ctx.save();

                ctx.translate(300 + Math.cos(angle + arc / 2) * textRadius, 300 + Math.sin(angle + arc / 2) * textRadius);

                ctx.rotate(angle + arc / 2 + Math.PI / 2);
                var text = "test";
                ctx.fillStyle = "white";
                ctx.fillText(text, -ctx.measureText(text).width / 2, 0);

                ctx.closePath();
               
                ctx.restore();
            }
        }
           
    }
};
</script>
</body>
</html>