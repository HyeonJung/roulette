<!DOCTYPE HTML>
<html lang="ko">
<head>
<title> 룰렛 </title>
<meta charset="utf-8">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript" src="js/jqueryRotate.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<style>
#image{
  margin:50px 50px;z-index:10;
}
#n_id{position:absolute;left:650px;top:290px;z-index:20;}
#start_btn{position:absolute;left:215px;top:210px;}
#text_input{margin-left:250px;}
#angle .input {width:20px;}
.btn-circle {
  width: 30px;
  height: 30px;
  text-align: center;
  padding: 6px 0;
  font-size: 12px;
  line-height: 1.428571429;
  border-radius: 15px;
}
.btn-circle.btn-xl {
  width: 150px;
  height: 150px;
  padding: 10px 16px;
  font-size: 24px;
  line-height: 1.33;
  border-radius: 75px;
}

</style>
</head>
<body>

<div class="col-md-6 col-xs-12 col-sm-12" style="text-align: center">
<canvas id="circle" width="600" height="600"></canvas>
<!--<img src="img/roulette.png" id="image">-->
<img src="img/niddle.png" id="n_id">
<br/>
<a class="btn btn-success btn-circle btn-xl" style="top:225px; left:400px; position:absolute" id="start_btn"><span class="glyphicon glyphicon-repeat" style="font-size:70px; margin-top:25px"></span></a>
</div>


<div class="col-md-6 col-lg-6 col-xs-12 col-sm-12">

<div class="col-md-2 col-lg-2 col-xs-2 col-sm-2 form-group" style="margin:auto;">
    <h2>제목</h2><br/>
</div>

<div class="col-md-10 col-lg-10 col-xs-10 col-sm-10">
    <input class="form-control" type="text" style=" text-align:center; margin-top:20px"/>
</div>

<div class="col-md-12 col-lg-12 col-xs-12 col-sm-12 form-group" style="margin:auto;">
    <h2>옵션 (최소 2, 최대 12)</h2><br/>
</div>

<div id="list">
</div>

<div class="col-md-2 col-lg-2 col-xs-2 col-sm-2 col-md-offset-4 col-sm-offset-4 col-lg-offset-4 col-xs-offset-4 form-group">
    <button type="button" class="btn btn-primary btn-lg" style="margin-top:20px" id="add"><span class="glyphicon glyphicon-plus"></span>추가하기</button>
</div>
<div class="col-md-2 col-lg-2 col-xs-2 col-sm-2 form-group">
    <button type="button" class="btn btn-success btn-lg" style="margin-top:20px" id="make">만들기</button>
</div>

</div>


<!-- <div style="margin-bottom:10px">
룰렛수 :
<input type="number" id="roulletNum" style="margin-left:16px" value="1" onchange="numChange()"/>
</div>

<div style="margin-bottom:10px" id="angleDiv">
각도 :
<input type="number" id="c1" style="margin-left:16px"  disabled/>
</div>

<div style="margin-bottom:10px" id="contentDiv">
문구 :
<input type="text" id="text1" class="text_input" style="margin-left:16px" maxlength="4"/ >
</div>

<div id="pointDiv">
포인트 :
<input type="number" id="point1" class="text_input"/>
</div> -->

<!-- <input type="button" value="만들기" id="make"/> -->




<script>
var roulletNum = 0;

function deleteElement(element) {
    $(element).parent().prev().remove();
    $(element).parent().remove();
    roulletNum--;
}


window.onload = function(){

    draw();

    var rate;
    var colors = ["#c281ea","#c82124","#3370d4","#FF9933","#339900"];
    var fillColor;
    var text;
    var point;
    var first = 0;

    $('#start_btn').click(function(){
        rotation();
    });

    $('#make').click(function() {
        make();
    })

    $('#add').click(function() {
        if (roulletNum > 11) {
            alert("최대 갯수를 초과하였습니다.");
            return;
        }

        var html = '<div class="col-md-8 col-lg-8 col-xs-9 col-sm-9 col-md-offset-2 col-lg-offset-2 col-xs-offset-2 col-sm-offset-2">';
        html += '<input class="form-control" type="text" style=" text-align:center;" maxlength="3"/></div>';
        html += '<div class="col-md-1 col-lg-1 col-xs-1 col-sm-1">'
        html += '<button type="button" class="btn btn-danger" style="margin:0 0 30px 0" onclick="deleteElement(this)"><span class="glyphicon glyphicon-remove"></span></button></div></div>'
        $("#list").append(html);
        roulletNum++;

    })

    /**
     * 회전
     */
    function rotation() {
        var random = randomize(0, 360);

        $("#circle").rotate({
          angle:0,
          animateTo:360 * 10 + random,
          center: ["50%", "50%"],
          easing: $.easing.easeInOutElastic,
          callback: function(){
                        var n = $(this).getRotateAngle();
                        endAnimate(n);
                    },
          duration:15000
       });
    }

    /**
     * 당첨
     */
    function endAnimate($n){
        var n = $n;

        var real_angle = n%360;

        var resultText;

        for (var i = rate.length; i >= 0; i--) {

            if (real_angle < 360 - rate[i]) {
                resultText = text[i];
                break;
            }
        }

        alert("당첨 : " + resultText);
    }

    function randomize($min, $max){
        return Math.floor(Math.random() * ($max - $min + 1)) + $min;
    }

    /**
     * 원 그리기
     */
    function draw() {
        var canvas = document.getElementById('circle');
            if (canvas.getContext)
            {
                var ctx = canvas.getContext('2d');

                var X = canvas.width / 2;
                var Y = canvas.height / 2;
                var R = 250;
                ctx.beginPath();
                ctx.arc(X, Y, R, 0, 2 * Math.PI, false);
                ctx.lineWidth = 3;
                ctx.strokeStyle = '#000000';

                ctx.stroke();
            }
    }

    /**
     * 룰렛 그리기
     */
    function make() {
        var textRadius = 160;

        rate = new Array();
        fillColor = new Array();
        text = new Array();

        rate.push(0);
        var angle = 360 / roulletNum;

        var list = $("#list").find("div");
        text.push(list.find("input").val());

        for (var i = 0; i < roulletNum; i++) {

            if (i > 0) {
                list = list.next().next();
                console.log(list.val());
                text.push(list.find("input").val());
            }

            fillColor.push(colors[i % 5]);
            rate.push(angle + (angle * i)); 
        }

        fillColor.push("#CC6699");
        var canvas = document.getElementById('circle');
        if (canvas.getContext)
        {
            var ctx = canvas.getContext('2d');

            ctx.clearRect(0,0,600,600);

            for (var i = 1; i < rate.length; i++) {
                var angle = (Math.PI/180) * rate[i-1];
                var arc = (Math.PI/180) * rate[i] - angle;
                ctx.beginPath();
                ctx.moveTo(300, 300);
                ctx.lineWidth = 5;
                ctx.strokeStyle = '#000000';
                ctx.arc(300,300,250,(Math.PI/180)*rate[i-1], (Math.PI/180)*rate[i],false);
                ctx.fillStyle = fillColor[i];
                ctx.stroke();
                ctx.fill();

                ctx.save();

                ctx.translate(300 + Math.cos(angle + arc / 2) * textRadius, 300 + Math.sin(angle + arc / 2) * textRadius);

                ctx.rotate(angle + arc / 2 + Math.PI / 2);
                var roulletText = text[i - 1];
                ctx.fillStyle = "white";
                ctx.font="25px Arial";
                ctx.fillText(roulletText, -ctx.measureText(roulletText).width / 2, 0,55);

                ctx.closePath();

                ctx.restore();
            }

            ctx.beginPath();
            ctx.moveTo(300, 300);
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#000000';
            ctx.arc(300,300,250,(Math.PI/180)*360,(Math.PI/180)*360,false);
            ctx.stroke();
        }

    }

    
};
</script>
</body>
</html>
